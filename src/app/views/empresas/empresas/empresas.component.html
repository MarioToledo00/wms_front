<div class="d-flex justify-content-between allign-items-center">
    <div>
      <h1>Empresas</h1>
      <p>Lista de empresas</p>
    </div>
    <div class="align-content-center">
        <button (click)="mostrarModal()"  color="primary" disabled="false" cButton>Agregar</button>
      </div>
  </div>  
  
  <div class="table-overflow-x" >
   
    <table striped="true" cTable>
        <thead>
        <tr>
            
            <th scope="col">Razón social</th>
            <th scope="col">Registro patronal</th>
            <th scope="col">Régimen</th>
            <th scope="col">Ciudad</th>
            <th scope="col">Dirección</th>
            <th scope="col">Editar</th>
        </tr>
        </thead>
        @if(!Loading){
          
          <tbody>
            
              @for (record of data; track record.id) {
                  <tr>
                      <td>{{record.razon_social}}</td>
                      <td>{{record.registro_patronal}}</td>
                      <td>{{record.regimen}}</td>
                      <td>{{record.ciudad}}</td>
                      <td>{{record.calle+' #'+record.numero_exterior+' CP.'+record.codigo_postal+', '+record.municipio+', '+record.estado+', '+record.pais}}</td>
                      <td><button class="btn"style="color: white;"  color="primary" cButton (click)="mostrarModal(true,record.id)"><img src="assets/svg/pencil.svg" alt="pencil" ></button></td>          
                  </tr>
              }   
            
          </tbody>
        
        }
      </table>
      
    
      @if(Loading){
        
          <c-spinner style="align-self: center;" color="primary"></c-spinner>

        
      }

      @if(!Loading && !data.length){
        
        <h3 style="align-self: center;" >No hay datos para mostrar</h3>
      
      }
</div>
     


        
<c-modal alignment="center" [visible]="modalRegistro" backdrop="static">
    <c-modal-header><b>{{TituloModal}}</b></c-modal-header>
    <c-modal-body>
      <form cForm [formGroup]="aplyForm" 
              #customStylesForm="ngForm"
                  (ngSubmit)="onSubmitRegister()"
                  [validated]="customStylesValidated"
                  cForm
                  class="row g-3 needs-validation">
                <p class="text-body-secondary">{{SubTituloModal}}</p>
                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilUser"></svg>
                  </span>
                  <input  autoComplete="razonSocial" cFormControl formControlName="razonSocial" placeholder="Razón social" required="true" [class.border-danger]="inValidRazonSocial" />
                </c-input-group>
                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilBuilding"></svg>
                  </span>
                  <input  autoComplete="nombreComercial" cFormControl  formControlName="nombreComercial"  placeholder="Nombre comercial" required="true" [class.border-danger]="inValidNombreComercial"/>
                </c-input-group>
                <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilPen"></svg>
                    </span>
                    <input  autoComplete="registroPatronal" cFormControl formControlName="registroPatronal" placeholder="Registro patronal" required="true" [class.border-danger]="inValidRegistroPatronal" />
                  </c-input-group>
                <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilLocationPin"></svg>
                    </span>
                    <select formControlName="pais"  aria-label="Default select example"  (change)="FiltrarEstados($event)" [class.border-danger]="inValidPais"  cSelect> 
                      <option value="" disabled selected>Pais...</option>
                      <option *ngFor="let pais of paises" [value]="pais.id" [style.cursor]="'pointer'">
                        {{ pais.nombre }}
                      </option>
                    </select>
                    
                </c-input-group>
                <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilLocationPin"></svg>
                    </span>
                    <select formControlName="estado"  aria-label="Default select example" (change)="FiltrarMunicipios($event)" [class.border-danger]="inValidEstado" cSelect> 
                      <option value="" disabled selected>Estado...</option>
                      <option *ngFor="let estado of estados" [value]="estado.id" [style.cursor]="'pointer'">
                        {{ estado.nombre }}
                      </option>
                    </select>
                    
                </c-input-group>
                <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilLocationPin"></svg>
                    </span>
                    <select formControlName="municipio"  aria-label="Default select example"  (change)="FiltrarCiudades($event)"[class.border-danger]="inValidMunicipio"  cSelect> 
                      <option value="" disabled selected>Municipio...</option>
                      <option *ngFor="let municipio of municipios" [value]="municipio.id" [style.cursor]="'pointer'">
                        {{ municipio.nombre }}
                      </option>
                    </select>
                    
                </c-input-group>
                <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilLocationPin"></svg>
                    </span>
                    <select formControlName="ciudad"  aria-label="Default select example" [class.border-danger]="inValidCiudad"  cSelect> 
                      <option value="" disabled selected>Ciudad...</option>
                      <option *ngFor="let ciudad of ciudades" [value]="ciudad.id" [style.cursor]="'pointer'">
                        {{ ciudad.nombre }}
                      </option>
                    </select>
                    
                </c-input-group>
                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilLocationPin"></svg>
                  </span>
                  <select formControlName="regimen"  aria-label="Default select example" [class.border-danger]="inValidRegimen"  cSelect> 
                    <option value="" disabled selected>Régimen...</option>
                    <option *ngFor="let regimen of regimenes" [value]="regimen.id" [style.cursor]="'pointer'">
                      {{ regimen.nombre }}
                    </option>
                  </select>
                  
              </c-input-group>
                <!-- <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilLockLocked"></svg>
                    </span>
                    <select formControlName="colonia"  aria-label="Default select example" cSelect> 
                      <option value="" disabled selected>Seleccione...</option>
                      <option *ngFor="let colonia of colonias" [value]="colonia.id" [style.cursor]="'pointer'">
                        {{ colonia.nombre }}
                      </option>
                    </select>
                    
                </c-input-group> -->
                <c-input-group class="mb-3">
                  <span cInputGroupText>
                   <svg cIcon name="cilLocationPin"></svg>
                  </span>
                  <input  autoComplete="codigoPostal" cFormControl formControlName="codigoPostal" placeholder="Codigo postal" required="true" [class.border-danger]="inValidCp" />
                </c-input-group>
                <c-input-group class="mb-3">
                  <span cInputGroupText>
                   <svg cIcon name="cilLocationPin"></svg>
                  </span>
                  <input  autoComplete="calle" cFormControl formControlName="calle" placeholder="Calle"  required="true" [class.border-danger]="inValidCalle" />
                </c-input-group>
                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilLocationPin"></svg>
                  </span>
                  <input  autoComplete="numInt" cFormControl formControlName="numInt" placeholder="Número interior" required="false" />
                  
                </c-input-group>
                <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilLocationPin"></svg>
                    </span>
                    <input  autoComplete="numExt" cFormControl formControlName="numExt" placeholder="Número exterior" required="true" [class.border-danger]="inValidNumExt" />
                    
                </c-input-group>
  
              </form>
    </c-modal-body>
    <c-modal-footer>
      <div>
        @if(editEmpresa){
          <button color="light" class="btn color-danger"  type="submit" (click)="this.alertDelete=true; this.modalRegistro =false;"  [disabled]="Loading">@if (Loading){<c-spinner aria-hidden="true" size="sm"></c-spinner>}Eliminar</button>
        }
      </div>
      <div>
        <button class="btn btn-secondary" (click)="cerrarModalRegistro()">Cancelar</button>
        <button class="btn btn-success" style="color: white;"  type="submit" (click)="onSubmitRegister()" [disabled]="Loading">@if (Loading){<c-spinner aria-hidden="true" size="sm"></c-spinner>}Guardar</button>
      </div>
    </c-modal-footer>
  
  
  
  </c-modal>



  <c-modal [visible]="alertDelete" alignment="center"  backdrop="static" >
    <c-modal-header><b>Confirmación</b></c-modal-header>
    <c-modal-body>
      ¿Estás seguro de que deseas eliminar esta empresa? Las plazas asociadas tambien serán eliminadas.
    </c-modal-body>
    <c-modal-footer>
      <div></div>
      <div>
        <button 
        color="secondary"
        cButton
        variant="outline"class="btn btn-secondary" (click)="this.alertDelete=false;cerrarModalRegistro()" [disabled]="Loading">Cancelar</button>
        <button class="btn btn-danger"style="color: white;" (click)="deleteEmpresa()" [disabled]="Loading">@if (Loading){<c-spinner aria-hidden="true" size="sm"></c-spinner>}Eliminar</button>
      </div>
    </c-modal-footer>
  </c-modal>

 
  


  <c-container class="floating-alert-container">
    <c-alert [(visible)]="inValidRequest" dismissible color="danger" fade class="alert">
        <strong>Error: </strong> {{RequestMessage}}.
    </c-alert>
    <c-alert [(visible)]="successRequest" dismissible color="success" fade class="alert">
        <strong>Éxito</strong> {{RequestMessage}}.
    </c-alert>
    <c-alert [(visible)]="warningRequest" dismissible color="warning" fade class="alert">
        <strong>Atención</strong> {{RequestMessage}}.
    </c-alert>
</c-container>